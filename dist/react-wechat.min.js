!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.reactWechat=e()}}(function(){return function e(t,n,i){function s(r,d){if(!n[r]){if(!t[r]){var c="function"==typeof require&&require;if(!d&&c)return c(r,!0);if(o)return o(r,!0);var a=new Error("Cannot find module '"+r+"'");throw a.code="MODULE_NOT_FOUND",a}var u=n[r]={exports:{}};t[r][0].call(u.exports,function(e){var n=t[r][1][e];return s(n?n:e)},u,u.exports,e,t,n,i)}return n[r].exports}for(var o="function"==typeof require&&require,r=0;r<i.length;r++)s(i[r]);return s}({1:[function(e,t,n){(function(e){"use strict";var n="undefined"!=typeof window?window.reflux:"undefined"!=typeof e?e.reflux:null,i="undefined"!=typeof window?window.jquery:"undefined"!=typeof e?e.jquery:null,s=n.createActions({requestOpenIdByCode:{asyncResult:!0},requestJSSDKConfig:{asyncResult:!0},getUserInfo:{asyncResult:!0},loadWechatLib:{asyncResult:!0},initJSSDKSettings:{asyncResult:!0},getWXLocation:{asyncResult:!0},getSubscribedUserInfo:{asyncResult:!0},setShareContent:{children:["shareCompleted","shareCanceled"]}}),o=function(){return window.location.href.replace(/#.*$/,"")},r=function(){return o().replace(/\/[^\/]*$/,"/")},d=function(e){return/^(http:|https:)/.test(e)?e:r()+e};s.requestOpenIdByCode.listen(function(e,t){i.ajax({url:e,type:"post",data:{code:t},dataType:"json",success:this.completed,error:this.failed})}),s.getUserInfo.listen(function(e,t,n){var s=this;i.ajax({url:e,type:"post",data:{openid:t,access_token:n},dataType:"json",success:this.completed,error:function(e){alert(e.responseText),s.failed()}})}),s.getSubscribedUserInfo.listen(function(e,t){var n=this;i.ajax({url:e,type:"post",data:{openid:t},dataType:"json",success:this.completed,error:function(e){alert(e.responseText),n.failed()}})});var c={},a={},u={},f=!1;s.requestJSSDKConfig.listen(function(e,t,n,s){c=n,f=s||!1,t||(t=o()),i.ajax({url:e,type:"get",data:{url:t},dataType:"json",success:this.completed,error:this.failed})}),s.loadWechatLib.listen(function(){var e=document.createElement("script");e.async="async",e.src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js",e.onload=this.completed,document.getElementsByTagName("head")[0].appendChild(e)}),s.requestJSSDKConfig.completed.listen(function(e){a=e,s.loadWechatLib()}),s.loadWechatLib.completed.listen(function(){s.initJSSDKSettings(c,a)});var l=!1;s.initJSSDKSettings.listen(function(e,t){var n={jsApiList:c,debug:f||!1,appId:t.appid,timestamp:t.timestamp,nonceStr:t.noncestr,signature:t.signature};u=window.wx;var i=this;u?(u.config(n),u.ready(function(){console.log("wx is ready"),l=!0,i.completed()}),u.error(function(e){console.error(e),i.failed(e)})):i.failed("no wx")}),s.getWXLocation.listen(function(){u?u.getLocation({success:this.completed}):this.failed("no wx")});var p=null;s.setShareContent.listen(function(e,t,n){e.link=d(e.link),n=n||"snsapi_base",t&&(e.link="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+t+"&redirect_uri="+encodeURIComponent(e.link)+"&response_type=code&scope="+n+"&state=STATE#wechat_redirect"),e.imgUrl=d(e.imgUrl),console.log(e.link),e.success=this.shareCompleted,e.cancel=this.shareCanceled,l&&u?(u.onMenuShareAppMessage(e),e.timelineTitle&&(e.title=e.timelineTitle),u.onMenuShareTimeline(e)):p=e}),s.initJSSDKSettings.completed.listen(function(){null!==p&&u&&(u.onMenuShareAppMessage(p),p.timelineTitle&&(p.title=p.timelineTitle),u.onMenuShareTimeline(p))}),t.exports=s}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){(function(n){"use strict";var i="undefined"!=typeof window?window.React:"undefined"!=typeof n?n.React:null,s="undefined"!=typeof window?window["react-router"]:"undefined"!=typeof n?n["react-router"]:null,o=s.RouteHandler,r="undefined"!=typeof window?window.reflux:"undefined"!=typeof n?n.reflux:null,d=e("./actions.js"),c=e("./stores.js"),a="undefined"!=typeof window?window.jquery:"undefined"!=typeof n?n.jquery:null,u=i.createClass({displayName:"WechatHandler",mixins:[r.connect(c.OpenIdStore,"openid"),r.connect(c.UserInfoStore,"userInfo"),r.connect(c.AccessTokenStore,"token"),r.connect(c.SubscribStatusStore,"subcribed")],getParameterByName:function(e){if(this.props.query[e])return this.props.query[e];e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search);return null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))},getInitialState:function(){return this.getParameterByName("openid")&&c.OpenIdStore.setOpenid(this.getParameterByName("openid")),this.hasRequestUserInfo=!1,this.hasRequestSubscirbeInfo=!1,{code:this.getParameterByName("code"),needOpenid:void 0!==this.props.codeToOpenidAPI}},getUserInfo:function(){this.state.openid&&this.props.userInfoAPI&&a.isEmptyObject(this.state.userInfo)&&this.state.token&&(this.hasRequestUserInfo||(d.getUserInfo(this.props.userInfoAPI,this.state.openid,this.state.token),this.hasRequestUserInfo=!0)),this.state.openid&&this.props.subscribedUserInfoAPI&&!c.SubscribStatusStore.tried&&(this.hasRequestSubscirbeInfo||(d.getSubscribedUserInfo(this.props.subscribedUserInfoAPI,this.state.openid),this.hasRequestSubscirbeInfo=!0))},componentDidMount:function(){d.requestJSSDKConfig(this.props.jssdkConfigAPI,"",this.props.jsAPIList,this.props.debug),this.state.needOpenid&&(!this.state.openid||this.props.userInfoAPI&&!this.state.token)&&this.state.code&&d.requestOpenIdByCode(this.props.codeToOpenidAPI,this.state.code),this.getUserInfo()},render:function(){return this.getUserInfo(),!this.state.needOpenid||this.state.openid||this.state.code?this.state.needOpenid&&!this.state.openid&&this.state.code?i.createElement("div",{className:"error"},"页面授权登录中..."):i.createElement(o,{key:"wechatHandler"}):i.createElement("div",{className:"error"},"请使用微信打开本页面")}});t.exports=u}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./actions.js":1,"./stores.js":4}],3:[function(e,t,n){"use strict";var i={};i.actions=e("./actions.js"),i.stores=e("./stores.js"),i.handler=e("./handler.js"),t.exports=i},{"./actions.js":1,"./handler.js":2,"./stores.js":4}],4:[function(e,t,n){(function(n){"use strict";var i="undefined"!=typeof window?window.reflux:"undefined"!=typeof n?n.reflux:null,s=e("./actions.js"),o=e("store2"),r="global",d=function(e){r=e},c=i.createStore({init:function(){this.listenTo(s.requestOpenIdByCode.completed,this.onOpenidReceived)},getInitialState:function(){return this.openid=o.get(r,{}).openid,this.openid},onOpenidReceived:function(e){this.openid=e.openid,this.saveToDb(),this.trigger(this.openid)},setOpenid:function(e){this.openid=e,this.saveToDb(),this.trigger(e)},saveToDb:function(){var e=o.get(r,{});e.openid=this.openid,o.set(r,e)}}),a=i.createStore({init:function(){this.user={},this.listenTo(s.getUserInfo.completed,this.onUserInfoReceived),this.listenTo(s.getSubscribedUserInfo.completed,this.onSubscribedUserInfoReceived)},getInitialState:function(){return this.user},onUserInfoReceived:function(e){this.user=e,this.trigger(e)},onSubscribedUserInfoReceived:function(e){e.subscribe&&(this.user=e,this.trigger(e))}}),u=i.createStore({init:function(){this.subcribed=!1,this.tried=!1,this.listenTo(s.getSubscribedUserInfo.completed,this.onSubscribedUserInfoReceived),this.listenTo(s.getSubscribedUserInfo,this.onStartToRequstSubecribedUserInfo)},getInitialState:function(){return this.subcribed},onStartToRequstSubecribedUserInfo:function(){this.tried=!0},onSubscribedUserInfoReceived:function(e){this.subcribed=1===e.subscribe,this.trigger(this.subcribed)}}),f=i.createStore({init:function(){var e=o.get(r,{});if(this.token=e.token||"",this.token){var t=e.expiresIn||0,n=e.fetchTime,i=new Date;n&&i-n>t&&(this.token="")}this.listenTo(s.requestOpenIdByCode.completed,this.onAuthReceived)},getInitialState:function(){return this.token},onAuthReceived:function(e){this.token=e.access_token,this.saveToDb(this.token,e.expires_in),this.trigger(this.token)},saveToDb:function(e,t){var n=o.get(r,{});n.token=this.token,n.expiresIn=t,n.fetchTime=new Date,o.set(r,n)}}),l=i.createStore({init:function(){this.status=!1,this.listenTo(s.initJSSDKSettings.completed,this.onInitCompleted)},getInitialState:function(){return this.status},onInitCompleted:function(){this.status=!0,this.trigger(this.status)}}),p=i.createStore({init:function(){this.listenTo(s.getWXLocation.completed,this.onGetLocationCompleted)},onGetLocationCompleted:function(e){console.log(e),this.trigger(e)}});t.exports={setNameSpace:d,OpenIdStore:c,UserInfoStore:a,SubscribStatusStore:u,AccessTokenStore:f,JsSDKStatusStore:l,LocationStore:p}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./actions.js":1,store2:void 0}]},{},[3])(3)});